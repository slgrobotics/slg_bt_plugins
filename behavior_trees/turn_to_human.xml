<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4" main_tree_to_execute="MainTree">

  <!--
  Note: this is a NO-PUMP version of the tree, meaning it does not use a FgsTopicToBlackboard "data pump" node.
        Use it if you have "#define USE_RCLCPP_SUBSCRIPTIONS" in all *.hpp files.
  -->
  
  <BehaviorTree ID="MainTree">
    <!-- This decorator ensures the tree never stops. 
         If children return SUCCESS, it restarts them immediately. -->
    <KeepRunningUntilFailure>
      
      <ReactiveFallback name="TopLevel">
        
        <!-- Priority 1: STOP gesture -->
        <Sequence name="StopGestureSequence">
          <IsStopGesture/>
          <CancelControl/>
          <!-- Return failure so the loop continues to check other nodes -->
          <!--AlwaysFailure/ -->
        </Sequence>

        <!-- Priority 2: Turn toward face -->
        <Sequence name="FaceDetectedSequence">
          <IsFaceDetected/>
          <TurnTowardFace angle_tolerance="0.1" max_turn_rate="0.5"/>
        </Sequence>

        <!-- Priority 3: Idle if nothing is happening -->
        <AlwaysSuccess name="Idle"/>

      </ReactiveFallback>

    </KeepRunningUntilFailure>
  </BehaviorTree>
</root>
