<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="MainTree">
    
    <KeepRunningUntilFailure>
      <!-- Note: KeepRunningUntilFailure allows exactly one child.
                 The single child of KeepRunningUntilFailure is this Sequence -->
      <Sequence name="MainLoop">

        <!-- 1. Update the Blackboard. The output ports must be primed with blackboard keys -->
        <FgsTopicToBlackboard
          topic_name="/bt/face_gesture_detect"
          is_face_detected="{is_face_detected}"
          face_yaw_error="{face_yaw_error}"
          gesture="{gesture}"
          is_stop_gesture="{is_stop_gesture}"
          is_like_gesture="{is_like_gesture}"
          is_ok_gesture="{is_ok_gesture}"
          is_yes_gesture="{is_yes_gesture}"
          is_six_gesture="{is_six_gesture}"
        />

        <!-- 2. React to the data -->
        <!-- We use a Fallback so that even if No Face is detected, 
             the Sequence doesn't "fail" and stop the loop -->
        <Fallback name="ReactionWrapper">
          <Sequence name="TraceIfFaceDetected">

            <IsFaceDetected is_face_detected="{is_face_detected}"/>
            <!-- cannot put an action node here, because its RUNNING state would block the loop and stop the pump -->
            <!-- <TurnTowardFace angle_tolerance="0.1" max_turn_rate="0.5" face_yaw_error="{face_yaw_error} /> -->

          </Sequence>
          
          <!-- If no face, this succeeds so the outer Sequence continues and the pump keeps working -->
          <AlwaysSuccess/>
        </Fallback>

      </Sequence>
    </KeepRunningUntilFailure>

  </BehaviorTree>
</root>
